<%= error_messages_for 'questionnaire' %>

<p>For help in creating a custom rubric: documentation <%= link_to "guide", "http://wikis.lib.ncsu.edu/index.php/Creating_Custom_Rubric" %> | <%= link_to "video", "http://www.youtube.com/watch?v=uUt1hMUMFbM" %>.</p>
<!--[form:questionnaire]-->
<table>
  <tr>
    <td valign="top"><label for="questionnaire_name">Name:</label>
      <%= text_field 'questionnaire', 'name'  %>
      <%= hidden_field 'questionnaire', 'id' %>
      <%= hidden_field 'questionnaire', 'type' %>
      <%= hidden_field 'questionnaire', 'section' %>
    </td>
  </tr>
</table>

<% if @questionnaire.type == 'QuizQuestionnaire' %>        <!--handle a questionnaire differently if it is a quiz-->
    <table id="questions_table">

      <% if $disp_flag != 1 %>
          <tr>
            <td colspan=2 style="padding-bottom: 5pt"><strong>Questions</strong>
          </tr>
          <tr>
            <td align=center width=300>Question</td>
            <%  if @questionnaire.type != 'QuizQuestionnaire' %><td align=left>weightr</td><%end%>
            <td align=center width=200>Hint</td>
          </tr>
      <% end %>

      <% for @new_question in @questionnaire.questions %>
          <% questionnum=1 %>
          <tr>
            <% if $disp_flag != 1 %>
                <td><%= text_field "new_question[]", 'txt', :size=>70 %></td>
            <% end %>
            <%  if @questionnaire.type == 'QuizQuestionnaire' %>
                <%  @quiz_question_choices = QuizQuestionChoice.find_all_by_question_id(@new_question.id) %>
            <% else %>
                <% i=1
                   @question_advices = QuestionAdvice.find_all_by_question_id(@new_question.id)
                   for @question_advice in @question_advices
                     if @question_advice.score == 1
                       @new_question.weight = i
                       break
                     else
                       i+=1
                     end
                   end %>
            <% end %>
            <%  if @questionnaire.type != 'QuizQuestionnaire' %>
            <td><%= select("new_question[]", :weight, Question::ANSWERS)%></td>
             <% end %>
            <td><% @question_type= QuestionType.find_by_question_id(@new_question.id)%><%=  text_field "question_type", 'parameters', :size=>70 %></td>
          </tr>
          <% i=1 %>
          <%  if @questionnaire.type == 'QuizQuestionnaire' %>
              <% for @quiz_question_choices in @quiz_question_choices %>
                  <tr>
                    <td>
                      &nbsp;&nbsp;&nbsp;
                      <% if @question_type.q_type=="MCC" %>
                          <% if @quiz_question_choices.iscorrect%>
                              <%= check_box_tag("new_choices[#{questionnum}][MCC][#{i}]","iscorrect", true) %>
                              &nbsp;<%= text_field "quiz_question_choices[]", 'txt', :size=>40 %>
                          <% else %>
                              <%= check_box_tag("new_choices[#{questionnum}][MCC][#{i}]","iscorrect", false) %>
                              &nbsp;<%= text_field "quiz_question_choices[]", 'txt', :size=>40 %>
                          <% end%>
                       <% else if @question_type.q_type=="MCR" %>
                              <% if @quiz_question_choices.iscorrect %>
                                  <%= radio_button("new_choices[#{questionnum}][MCR][#{i}]",:iscorrect, true)%>
                              <% else %>
                                  <%= radio_button("new_choices[#{questionnum}][MCR][#{i}]",:iscorrect, false)%>
                               <% end %>
                              &nbsp;<%= text_field "quiz_question_choices[]", 'txt', :size=>40 %>
                        <% else if @question_type.q_type=="TF" %>
                               <% if @quiz_question_choices.iscorrect %>
                                    <%= radio_button("new_choices[#{questionnum}][TF][1]",:iscorrect, true) %>   True
                                    <%= radio_button("new_choices[#{questionnum}][TF][1]",:iscorrect, false) %>  False
                               <% else %>
                                    <%= radio_button("new_choices[#{questionnum}][TF][1]",:iscorrect, false) %>  True
                                    <%= radio_button("new_choices[#{questionnum}][TF][1]",:iscorrect, true) %>   False
                              <%end%>
                              <% else %>     wrong
                       <% end %><% end %><% end %>

                    </td>
                  </tr>
                  <% i+=1 %>
              <% end %>
          <% else %>
              <% for @question_advice in @question_advices %>
                  <tr>
                    <td>
                      &nbsp;&nbsp;&nbsp;<%= i%>.&nbsp;<%= text_field "question_advice[]", 'advice', :size=>40 %>
                    </td>
                  </tr>
                  <% i+=1 %>
              <% end
                 end %>
          </table>
          <% questionnum+=1 %>
      <% end %>
<% else %>


    <table>
      <tr>
        <td>Questionnaire Type</td>
        <td><input id="section" type="text" value='<%="#{@questionnaire.section}"%>' size=3 disabled="true"></td>
      </tr>
      <tr>
        <td>Min question score:</td>
        <td><%= text_field 'questionnaire', 'min_question_score', :size=> 1 %>&nbsp;&nbsp;</td>
        <td>Max question score:</td>
        <td><%= text_field 'questionnaire', 'max_question_score', :size=> 1 %>&nbsp;&nbsp;</td>
        <td>Is this <%= @questionnaire.display_type %> private:</td>
        <td><%= select(:questionnaire, :private, [ ['no', false],
                                                   ['yes',  true]])%>
        </td>
      </tr>
    </table>
    <br/>
    <table id="questions_table">
      <tr>
        <% if @questionnaire.type != "QuizQuestionnaire" %>
            <td colspan=2 style="padding-bottom: 5pt"><strong>Questions</strong>
              <input style="margin-left: 50pt" type="button" value="Add" onclick="addQuestions()">
              <input id="numQuestionsToAdd" type="text" value="1" size=1> more question(s)
            <td colspan=2><input type="button" value="Delete selected questions" onclick= "deleteQuestions()"></td>

        <% end %>
        <% if @questionnaire.questions.length > 0 %>
            <td colspan=2><input type="button" id="deleteQuestion" value="Delete selected questions" onclick="deleteQuestions()"></td>
        <% else %>
            <td colspan=2><input type="button" id="deleteQuestion" value="Delete selected questions" onclick="deleteQuestions()" disabled="true"></td>
        <% end %>
      </tr>
      <%# if @questionnaire.questions.length > 0 %>
      <tr>
        <td align=left width=30>Delete</td>
        <td align=center width=300>Question</td>
        <td align=center width=100>Scoring</td>
        <% if (@questionnaire.section == "Custom") %>
            <td align=center width=100>Parameters</td>
        <%end%>
        <td align=left>Weight</td>
      </tr>
      <% #end %>
      <% 	i = 1   %>
      <% for @question in @questionnaire.questions %>
          <% @q = QuestionType.find_by_question_id(@question.id) if !params['import'] %>
          <% @q ||= QuestionType.new %>
          <% if params['import']  %>
              <% @q = QuestionType.new %>
          <% end %>
          <tr>
            <td align=center><input type=checkbox id="question_chk<%= i %>"></td>
            <td><%= text_field "question[]", 'txt', :size=>70 %></td>
            <% if (@questionnaire.section == "Custom") %>
                <% if params['import'] %>
                    <% selected_value = 0 %>
                <% elsif @q.q_type == "Checkbox"  %>
                    <% selected_value = 0 %>
                <% elsif @q.q_type == "TextField"%>
                    <% selected_value = 1 %>
                <% elsif @q.q_type == "TextArea"%>
                    <% selected_value = 2 %>
                <% elsif @q.q_type == "DropDown"%>
                    <% selected_value = 3 %>
                <% elsif @q.q_type == "UploadFile"%>
                    <% selected_value = 4 %>
                <% else selected_value = 5 %>
                <% end %>

                <td><%= select("q[]", :q_type, Question::GRADING_TYPES_CUSTOM, :selected => selected_value)%></td>
                <td><%= text_field "q[]",  'parameters', :size=>30 %></td>

            <%else%>
                <td><%= select("question[]", :true_false, Question::GRADING_TYPES)%></td>
            <% end%>

            <td><%= select("question[]", :weight, Question::WEIGHTS)%></td>
          </tr>
          <% 	i += 1 %>
      <% end %>
<%end %>
</table>

<BR/>
<!--[eoform:course]-->

