<H1>Score for <%= @assignment.name %></H1>
   
<TABLE class="grades" >
<%= render :partial => 'grades/participant_title', :locals => {:prefix => nil} %>                      
<%= render :partial => 'grades/participant', :locals => {:prefix => 'user',  :team => false, :pscore => @pscore} %>
</TABLE>
<BR/>
<%= stylesheet_link_tag 'jquery-ui-timepicker-addon' %>
<%= stylesheet_link_tag 'jquery-ui-1.10.3.custom.min' %>
<script src="/javascripts/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/javascripts/jquery-ui-timepicker-addon.js"></script>

<%= form_for @assignment, html: {id: 'assignment_form'} do %>
   <div style=" ">
    <% pscore=@pscore
       participant = pscore[:participant]
       if pscore[:max_pts_available]
         score_postfix = sprintf(" / %.2f",pscore[:max_pts_available])
       else
         score_postfix = "%"
       end %>

    <% stage = participant.assignment.get_current_stage(participant.topic_id) %>
    <% if controller.action_name == 'view' or controller.action_name == "view_my_scores" %>

          <% if stage == "Complete" %>
              <% if participant.grade
                   total_score = participant.grade
                   title = "A score in blue indicates that the value was overwritten by the instructor or teaching assistant."
                 else
                   total_score = pscore[:total_score]
                   title = nil
                 end %>
              <div <% if title %>title="<%=title%>" style="color:#0033FF"<% end %>><%= sprintf("%.2f",total_score) %><%= score_postfix %></div>
              <% if controller.action_name != "view_my_scores" %>
                  <BR/><FONT SIZE="-1"><%= link_to 'edit score', :action => 'edit', :id => participant.id %></FONT>
              <% end %>
          <% else %>
              <FONT SIZE="-1">(in <%= stage %>)</FONT>
          <% end %>

    <% else %>
        <% if participant.grade %>
           <%= text_field("participant", "grade", :size => 10) %><%= score_postfix %>
        <% else %>
           <%= text_field("participant", "grade", :size => 10, :value => sprintf("%.2f", pscore[:total_score])) %><%= score_postfix %>
        <% end %>
    <% end %>

     </div>
    <div id="tabs">
      <ul>
        <li><a href="#tabs-1">Submitted Work</a></li>
        <li><a href="#tabs-2">Metareview</a></li>
        <li><a href="#tabs-3">Author Feedback</a></li>
        <li><a href="#tabs-4">TeamMate Review</a></li>
        <li><a href="#tabs-5">Total Score</a></li>
      </ul>
      <div id="tabs-1">
        <%##renders a new tab for reviews on submitted work%>
       <p><%= render :partial => 'grades/submitted_work', :locals => {:prefix => 'user',  :team => false, :pscore => @pscore} %> </p>
      </div>
      <div id="tabs-2">
        <%##renders a new tab for meta reviews%>
        <%= render :partial => 'grades/meta', :locals => {:prefix => 'user',  :team => false, :pscore => @pscore} %>
      </div>
      <div id="tabs-3">
        <%##renders a new tab for author feedback%>
        <%= render :partial => 'grades/author',:locals => {:prefix => 'user',  :team => false, :pscore => @pscore} %>
      </div>
      <div id="tabs-4">
        <%##renders a new tab for team mate reviews%>
        <%= render :partial => 'grades/teammate',:locals => {:prefix => 'user',  :team => false, :pscore => @pscore} %>
      </div>
      <div id="tabs-5">
        <%##renders a new tab for scores%>
        <%= render 'grades/scores', participant: participant %>
      </div>
    </div>
    <script>
        jQuery(document).ready(function () {
            jQuery("#tabs").tabs();
        });
    </script>
<% end %>


<a href="javascript:window.history.back()">Back</a>
