<h1>Publishing rights for <%= @assignment.name %> assignment</h1>

<% if flash[:notice] %>
    <div class="flash_note"><%= flash[:notice] %></div>
<% end %>


<% if @sign_up_topics.size != 0 %>

    <table class="general">
    	<tr>
  <th width="5%" rowspan="2">Topic #</th>
  <th width="60%" rowspan="2">Topic name(s)</th>
  <th width="35%" colspan="4">Participant</th>
	</tr>
    	<tr>
  <th>Name</th>
  <th>Fullname</th>
  <th>Publish Rights</th>
  <th>Verified</th>
	</tr>
	
      <% i=1 %>
      <% for topic in @sign_up_topics %>
          <tr>
            <td><%= topic.topic_identifier %></td>
            <td><%= render :partial => 'topic_names', :locals => {:i => i, :topic=>topic} %></td>
            <th>&nbsp;</th>
            <th>&nbsp;</th>
            <th>&nbsp;</th>
            <th>&nbsp;</th>
          </tr>

          <% if (@assignment.participants.size > 0)

			  for signed_up_user in topic.signed_up_users
				user = signed_up_user.creator
		  %>
		  	    <tr>
	 	  		  <th>&nbsp;</th>
	 	  		  <th>&nbsp;</th>
				  <td><%=user.name%></td>
				  <td><%=user.fullname%></td>
	      <%
				  permissionGranted = false
				  for participant in @assignment.participants
					if (user.id == participant.user.id)
					  permissionGranted = participant.permission_granted?
					  hasSignature = !participant.digital_signature.nil?
					  if (permissionGranted && hasSignature)
						  signatureValid = participant.verify_digital_signature(participant.digital_signature)
					  end
					end
				  end
	      %>
			      <td><%=(permissionGranted ? "granted" : "denied") %></td>
			      <td>
			      	<% if (permissionGranted && hasSignature)
					     if (signatureValid) %>
			      	       <img src="/images/Check-icon.png"/>
				         <% else %>
			      	       <img src="/images/delete_icon.png"/>
				         <% end
                       end %>
				    &nbsp;
			      </td>
			   </tr>
		  <% 
			  end
			 end
		  %>


          <% i=i+1 %>
      <% end %>

    </table>
<% end %>

